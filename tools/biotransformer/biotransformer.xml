<tool id="biotransformer" name="BioTransformer" version="@TOOL_VERSION@+galaxy5" profile="23.0">
    <description>Generate biotransformation products for molecules.</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="creator"/>
    <xrefs>
        <xref type="bio.tools">biotransformer</xref>
    </xrefs>

    <requirements>
        <requirement type="package" version="3.0_20230403">biotransformer</requirement>
        <requirement type="package" version="3.1.1">openbabel</requirement>
        <requirement type="package" version="2.3.1">pandas</requirement>
    </requirements>

    <required_files>
        <include path="wrapper_biotransformer.py"/>
    </required_files>

    <command detect_errors="aggressive"><![CDATA[
        python3 '${__tool_directory__}/wrapper_biotransformer.py'
         -k $k
         -b $b
         -s $steps
         -t $tolerance
         -a
         -icsv $input_file
         -ocsv $output_file
         -ocsvDup $output_file2
         -ocsvDup2 $output_file3
          ]]>
    </command>
    <inputs>
        <param name="k" type="select" value="pred"
               label="The task to be performed [pred=prediction, cid=compound identification]."
               help="Select the task to be performed. 
                     For prediction, the tool will generate biotransformation products for the input molecules.
                     For compound identification, it will identify compounds based on their chemical structure.">
            <option value="pred" selected="true">pred</option>
            <option value="cid">cid</option>
        </param>
        <param name="b" type="select" value="ecbased" label="The type of description." help="Select the type of biotransformation description to use. 
                     Options include EC-based, CYP450, Phase II, Human gut microbial, Super transformer 1 (superbio), 
                     Super transformer 2 (allHuman), and Environmental microbial.">
            <option value="ecbased" selected="true">EC-based</option>
            <option value="cyp450">CYP450</option>
            <option value="phaseII">Phase II</option>
            <option value="hgut">Human gut microbial</option>
            <option value="superbio">Human super transformer 1 (superbio)</option>
            <option value="allHuman">Human super transformer 2 (allHuman)</option>
            <option value="envimicro">Environmental microbial</option>
        </param>
        <param name="steps" type="integer" value="1" min="1" max="5" label=" The number of steps for the prediction." help="Number of transformation steps to predict."/>
        <param name="tolerance" type="float" value="0.01" label="Mass tolerance for metabolite identification." help="Tolerance is used in Da for identification."/>
        <param name="input_file" type="data" format="csv" label="Input CSV file." help="Input table with SMILES strings to predict the biotransformation products for."/>
    </inputs>

    <outputs>
        <data format="tabular" name="output_file" label="BioTransformer on ${on_string}"/>
        <data format="tabular" name="output_file2" label="BioTransformer with filter on ${on_string}"/>
        <data format="tabular" name="output_file3" label="BioTransformer with super filter on ${on_string}"/>
    </outputs>

    <tests>
        <test>
            <param name="k" value="pred"/>
            <param name="b" value="allHuman"/>
            <param name="steps" value="1"/>
            <param name="tolerance" value="0.01"/>
            <param name="input_file" value="smiles.csv"/>
            <output name="output_file">
                <assert_contents>
                    <has_size value="9818" delta="300"/>
                    <has_n_lines n="250" delta="25"/>
                </assert_contents>
            </output>
            <output name="output_file2">
                <assert_contents>
                    <has_size value="9818" delta="300"/>
                    <has_n_lines n="250" delta="25"/>
                </assert_contents>
            </output>
            <output name="output_file3">
                <assert_contents>
                    <has_size value="8497" delta="300"/>
                    <has_n_lines n="200" delta="25"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help>
        <![CDATA[
            @HELP@
        ]]>
    </help>
    <citations>
        <citation type="doi">https://doi.org/10.1186/s13321-018-0324-5</citation>
    </citations>
</tool>
