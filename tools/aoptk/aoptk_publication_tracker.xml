<tool id="aoptk_publication_tracker" name="aoptk publication tracker" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="25.1" license="MIT">
    <description>Tool to track publications.</description>
    <macros>
        <import>macros.xml</import>
    </macros>

    <requirements>
        <expand macro="requirements"/>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        ln -s '$read' 'read.${read.ext}' &&
        ln -s '$master' 'master.${master.ext}' &&
        publication-tracker
        --code "$code"
        --email \$EMAIL
        --query '$query'
        --database "$literature_database"
        --read 'read.${read.ext}'
        --master 'master.${master.ext}'
        --outdir .
    ]]></command>

    <inputs>
        <expand macro="inputs"/>
        <param argument="--code" type="text" value="" label="Your search code" help="Type your search code. E.g., 1.1. or 1.2.1.">
            <sanitizer invalid_char="">
                <valid initial="string.digits">
                    <add value="." />
                 </valid>
            </sanitizer>
            <validator type="regex">^\d+(\.\d+)*\.?$</validator>
        </param>
        <param argument="--read" type="data" format="xlsx" label="Your database of read publications" help="Your database of read publications. Column id must be present." />
        <param argument="--master" type="data" format="xlsx" label="Your master table" help="Your master table. Columns ID and Search code must be present." />

    </inputs>

    <outputs>
        <data name="updated_master_table" format="xlsx" from_work_dir="updated_master_table.xlsx" label="Updated master table" />
        <data name="to_read" format="xlsx" from_work_dir="read.xlsx" label="To read" />
    </outputs>

    <tests>
        <!-- Hint: You can use [ctrl+alt+t] after defining the inputs/outputs to auto-scaffold some basic test cases. -->
        <test>
           <param name="query" value="hepg2 thioacetamide"/>
           <param name="code" value="1.1.1."/>
           <param name="literature_database" value="pubmed"/>
           <param name="read" value="read_test.xlsx"/>
           <param name="master" value="master_test.xlsx"/>
           <output name="to_read" file="read.xlsx" compare="sim_size" delta="100"/>
        </test>
        <test>
           <param name="query" value="hepg2 heparg thioacetamide spheroid"/>
           <param name="code" value="1.2.1."/>
           <param name="literature_database" value="europepmc"/>
           <param name="read" value="read_test.xlsx"/>
           <param name="master" value="master_test.xlsx"/>
           <output name="to_read" file="read.xlsx" compare="sim_size" delta="100"/>
        </test>
        <test>
           <param name="query" value="lx-2 col1a1"/>
           <param name="code" value="3.1."/>
           <param name="literature_database" value="pubmed"/>
           <param name="read" value="read_test.xlsx"/>
           <param name="master" value="master_test.xlsx"/>
           <output name="updated_master_table" file="updated_master_table.xlsx" compare="sim_size" delta="100"/>
        </test>
    </tests>
    <help><![CDATA[

Publication-Tracker
===================
Publication-Tracker allows you to filter for publications which you have read already and automatically update search codes in your master table.

How It Works
------------
- Provide your email address — required by NCBI.
- Enter a search term — exactly as you would in PubMed or Europe PMC.
- Choose a database — PubMed or Europe PMC.
- Assign a search code — a unique identifier for your search, e.g., 1.1. or 1.2.1. Maintain rationale behind this search code in Search-code table.
- Upload database of read publications — an Excel file with a column named `id` containing publications you have already read.
- Upload master table — an Excel file with columns `ID` and `Search code`. This is where you will map your publications to their corresponding search codes.
- Master table with updated search codes will be generated.
- File with yet not read publications will be generated.

Output Files
------------

- **Publications to read:** List of publications that match your search term and have not been read yet.
- **Updated master table:** Master table with updated search codes.

Notes on Creating Database of Read Publications and Master Table
----------------------------------------------------------------

- **Database of read publications:** Must be an Excel file with a column named `id` containing the PubMed IDs (or other identifier if not available) of the publications you have read.
- **Master table:** Must be an Excel file with columns `ID` (PubMed ID or other identifier) and `Search code`. This table will be updated with new search codes.

How to cite
===========

If you use Publication-Tracker in your research, please cite [DOI TBA]. 
Publication-Tracker was originally developed for the purposes of this publication.


    ]]></help>
    <citations>
        <citation type="doi">10.1093/bioinformatics/btp163</citation>
    </citations>
</tool>