<tool id="aoptk_chemical_identifier" name="aoptk chemical identifier" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="25.01" license="MIT">
    <description>Detect chemicals in scientific literature and filter based on a screening list.</description>
    <macros>
        <token name="@TOOL_VERSION@">0.1.0</token>
        <token name="@VERSION_SUFFIX@">0</token>
    </macros>

    <requirements>
        <requirement type="package" version="0.1.1.">aoptk</requirement>
    </requirements>

    <required_files>
    </required_files>
 
    <command detect_errors="exit_code"><![CDATA[
        chemical-identifier
        --query '$query'
        --literature_database "$literature_database"
        --email "$email"
        --chemical_database "$chemical_database"
        --outdir .
    ]]></command>

    <inputs>
        <param argument="--query" type="text" value="" label="Your search term" help="Type your search term as you would in PubMed/Europe PMC.">
            <sanitizer invalid_char="">
                <valid initial="string.letters,string.digits">
                    <add value="_" />
                    <add value=" " />
                    <add value="&apos;" />
                    <add value="&quot;" />
                    <add value="(" />
                    <add value=")" />
                    <add value="*" />
                    <add value="[" />
                    <add value="]" />
                    <add value="-" />
                    <add value=":" />
                    <!-- Lowercase Greek letters -->
                    <add value="α" />
                    <add value="β" />
                    <add value="γ" />
                    <add value="δ" />
                    <add value="ε" />
                    <add value="ζ" />
                    <add value="η" />
                    <add value="θ" />
                    <add value="ι" />
                    <add value="κ" />
                    <add value="λ" />
                    <add value="μ" />
                    <add value="ν" />
                    <add value="ξ" />
                    <add value="ο" />
                    <add value="π" />
                    <add value="ρ" />
                    <add value="σ" />
                    <add value="τ" />
                    <add value="υ" />
                    <add value="φ" />
                    <add value="χ" />
                    <add value="ψ" />
                    <add value="ω" />
                    <!-- Uppercase Greek letters -->
                    <add value="Α" />
                    <add value="Β" />
                    <add value="Γ" />
                    <add value="Δ" />
                    <add value="Ε" />
                    <add value="Ζ" />
                    <add value="Η" />
                    <add value="Θ" />
                    <add value="Ι" />
                    <add value="Κ" />
                    <add value="Λ" />
                    <add value="Μ" />
                    <add value="Ν" />
                    <add value="Ξ" />
                    <add value="Ο" />
                    <add value="Π" />
                    <add value="Ρ" />
                    <add value="Σ" />
                    <add value="Τ" />
                    <add value="Υ" />
                    <add value="Φ" />
                    <add value="Χ" />
                    <add value="Ψ" />
                    <add value="Ω" />
                </valid>
            </sanitizer>
            <validator type="regex">[0-9a-zA-Z_ ()*'"[\]\[\]\-:.\[\]α-ωΑ-Ω]+</validator>
        </param>
        <param argument="--email" type="text" value="" label="E-mail" help="E-mail is required to follow NCBI/PubMed guidelines.">
            <sanitizer invalid_char="">
                <valid initial="default">
                    <add value="_" />
                    <add value="@" />
                    <add value='"' />
                </valid>
            </sanitizer>
            <validator type="regex">[0-9a-zA-Z_]*</validator>
        </param>
        <param name="literature_database" type="select" label="Select which database to search." help="PubMed only accepts searches with up to 10 000 results. No limit for Europe PMC.">
            <option value="pubmed" selected="true">PubMed</option>
            <option value="europepmc">Europe PMC</option>
        </param>
        <param argument="--chemical_database" type="data" format="xlsx" label="Chemical database" help="Custom chemical database with toxicologically relevant chemicals. Excel file with single column: chemical_name. Examples can be found in Citations." />
    </inputs>

    <outputs>
        <data name="Chemicals_per_publication" format="xlsx" from_work_dir="chemicals_per_publication.xlsx" label="Chemicals_per_publication" />
        <data name="Publications_per_chemical" format="xlsx" from_work_dir="publications_per_chemical.xlsx" label="Publications_per_chemical" />
    </outputs>

    <tests>
        <!-- Hint: You can use [ctrl+alt+t] after defining the inputs/outputs to auto-scaffold some basic test cases. -->
        <test>
           <param name="email" value=""/>
           <param name="query" value="hepg2 thioacetamide"/>
           <param name="literature_database" value="pubmed"/>
           <param name="chemical_database" link="https://zenodo.org/records/16532456"/>
           <output name="Chemicals_per_publication" file="chemicals_per_publication_test.xlsx" compare="sim_size" delta="100"/>
        </test>
        <test>
            <param name="email" value=""/>
            <param name="query" value="hepg2 thioacetamide spheroid"/>
            <param name="literature_database" value="europepmc"/>
            <param name="chemical_database" link="https://zenodo.org/records/16532456"/>
            <output name="Publications_per_chemical" file="publications_per_chemical.xlsx" compare="sim_size" delta="100"/>
        </test>
    </tests>
    <help><![CDATA[



Chemical-Identifier
===================

Overview
--------

Chemical-Identifier uses named-entity recognition (NER) to extract suspected chemical names from scientific publication abstracts. These entities are then matched against a user-defined database of relevant chemicals to help toxicologists identify publications of interest. It:

- **Extracts chemical entities** using ScispaCy's NER.
- **Normalizes synonyms** by mapping entities to Medical Subject Headings (MeSH) terms.
- **Identifies relevant publications** by cross-referencing with the user-defined chemical list (e.g., Tox21 chemicals). Alternatively, it can be used to explore which chemicals co-occur with a given search term.

Due to character and Boolean operator limits on platforms like PubMed and Europe PMC, it is impossible to include large chemical name lists directly in search queries. Chemical-Identifier addresses this limitation.

How It Works
------------

- Enter a search term — exactly as you would in PubMed or Europe PMC.
- Provide your email address — required by NCBI.
- Choose a database — PubMed or Europe PMC.
- Select a chemical list — use built-in Tox21/TG-GATEs lists or upload an Excel file with a ``chemical_name`` column (examples of such lists can be found in Citations).

Output Files
------------

- **Chemicals per publication:** Publications whose abstracts mention a relevant chemical from your list.
- **Publications per chemical:** Table showing which chemicals are associated with your search term.

Practical Tips
--------------

- PubMed: Keep the raw search below 10,000 results.
- Europe PMC: Searches the full text by default. Prepend ``TITLE_ABS:`` to limit to title + abstract, e.g. ``TITLE_ABS:(hepg2 spheroid)``.


How to cite
===================

If you use Chemical-Identifier in your research, please cite [DOI TBA]. 
For the purposes of this publication, Chemical-Identifier was originally developed and used with chemical lists obtained from Tox21 and TG-GATEs.

    ]]></help>
    <citations>
        <citation type="doi">qAOP PUBLICATION DOI TBA</citation>
        <citation type="doi">10.5281/zenodo.4471245</citation>
        <citation type="doi">10.18653/v1/w19-5034</citation>
        <citation type="doi">10.1093/bioinformatics/btp163</citation>
        <citation type="doi">10.5281/zenodo.16532960</citation>
        <citation type="doi">10.5281/zenodo.16532455</citation>
        <citation type="doi">10.5281/zenodo.16533100</citation>
        <citation type="doi">10.5281/zenodo.16533282</citation>
        <citation type="doi">10.5281/zenodo.16533439</citation>
    </citations>
</tool>