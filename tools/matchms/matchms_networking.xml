<tool id="matchms_networking" name="matchMS networking" version="@TOOL_VERSION@+galaxy0" python_template_version="3.5">
    <description>create similarity network graph from matchMS similarity scores</description>

    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="creator"/>

    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">matchms</requirement>
    </requirements>

    <command detect_errors="aggressive"><![CDATA[
        sh ${matchms_networking_cli}
    ]]></command>

    <configfiles>
        <configfile name="matchms_networking_cli">
            python3 ${__tool_directory__}/matchms_networking_wrapper.py \
                --scores "$similarity_scores" \
                --identifier "$identifier_key" \
                --top_n "$top_n" \
                --max_links "$max_links" \
                --score_cutoff "$score_cutoff" \
                --link_method "$link_method" \
                --keep_unconnected_nodes "$keep_unconnected_nodes" \
                --output "$similarity_network"
        </configfile>
    </configfiles>

    <inputs>
        <param label="Similarity scores" name="scores" type="data" format="json"
            help="matchMS similarity-scores file."/>
        <param label="Identifier key" name="identifier_key" type="text"
            help="Unique metadata identifier of each spectrum from which scores are computed."/>
        <param label="Number of top edges to keep" name="top_n" type="integer" value="20"
            help="The number of highest-score edges to keep between a pair of nodes. Depending on 'Link method' parameter the top N edges will be selected either from disjoined
            sets of individual specta or joined subset of scores between the given pair of spectra. This value has to be higher than the 'Maximum number of links'."/>
        <param label="Maximum number of links per node" name="max_links" type="integer" value="10"
            help="Maximum number of links to add per node."/>
        <param label="Score cutoff" name="score_cutoff" type="float" value="0.7" min="0.0" max="1.0"
            help="Minimum similarity score value to link two spectra."/>
        <param label="Link method" name="link_method" type="select" display="radio"
            help="Method for computing top N edges for each node.
            If selected 'Single', top N nodes will be selected from disjoined sets of highest scores for nodes of a given pair (i.e., if a given edge belongs to top N scores of at least one node, it is kept).
            If selected 'Mutual', top N nodes will be selected from a joined subset of a given spectra pair (i.e., if and only if a given edge belongs to top N scores of both nodes, it is kept).">
            <option value="single" selected="true">Single</option>
            <option value="mutual">Mutual</option>
        </param>
        <param label="Keep unconnected nodes" name="keep_unconnected_nodes" type="boolean" checked="true"
            help="If set to No all unconnected nodes will be removed."/>
    </inputs>

    <outputs>
        <data label="Similarity network of ${scores}" name="similarity_network" format="graphml,cyjs,gexf,gml,json"/>
    </outputs>

    <tests>
        <test>
            <param name="scores" value="networking/scores.json" ftype="json"/>
            <output name="similarity_network" file="networking/similarity_network.graphml" ftype="graphml"/>
        </test>
        <test>
            <param name="scores" value="networking/scores.json" ftype="json"/>
            <output name="similarity_network" file="networking/similarity_network.cyjs" ftype="cyjs"/>
        </test>
        <test>
            <param name="scores" value="networking/scores.json" ftype="json"/>
            <output name="similarity_network" file="networking/similarity_network.gexf" ftype="gexf"/>
        </test>
        <test>
            <param name="scores" value="networking/scores.json" ftype="json"/>
            <output name="similarity_network" file="networking/similarity_network.gml" ftype="gml"/>
        </test>
        <test>
            <param name="scores" value="networking/scores.json" ftype="json"/>
            <output name="similarity_network" file="networking/similarity_network.json" ftype="json"/>
        </test>
    </tests>

    <help><![CDATA[
        @HELP_matchms_networking@
    ]]></help>

    <citations>
        <citation type="doi">10.5281/zenodo.4589154</citation>
        <citation type="doi">10.21105/joss.02411</citation>
    </citations>

</tool>
