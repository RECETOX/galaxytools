<tool id="ipapy2_gibbs_sampler_add" name="IPA gibbs sampler" version="@TOOL_VERSION@+galaxy0" profile="21.05">
    <macros>
        <import>macros.xml</import>
    </macros>
    
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">ipapy2</requirement>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        python3 '${__tool_directory__}/ipapy2_gibbs_sampler_add.py'
        --mapped_isotope_patterns '${mapped_isotope_patterns}'
        --annotations '${annotations}'
        --noits '${noits}'
        --burn '${burn}'
        --delta_add '${delta_add}'
        --all_out '${all_out}'
        --zs '${zs}'
        --zs_out '${zs_out}'
        --annotations_out '${annotations_out}'
    ]]></command>

    <inputs>
        <param label="Mapped isotope patterns" name="mapped_isotope_patterns" type="data" format="csv" help="A csv file containing the MS1 data. Ideally obtained from map_isotope_patterns."/>
        <param label="annotations" name="annotations" type="data" format="csv" help="pandas dataframe containing all the possible annotations for the measured features."/>
        <param label="gibbs sampler iterations" name="noits" type="integer" value="1000" help="number of iterations if the Gibbs sampler to be run."/>
        <param label="ignored iterations" name="burn" type="integer" optional="true" value="10" help="number of iterations to be ignored when computing posterior probabilities. If None, is set to 10% of total iterations."/>
        <param name="delta_add" type="float" value="1" min="0" label="adducts weight" help="parameter used when computing the conditional priors. The parameter must be positive. The smaller the parameter the more weight the adducts connections have on the posterior probabilities. Default 1." />
        <param label="return each iteration" name="all_out" type="boolean" value="false" optional="true" help="logical value. If true the list of assignments found in each iteration is returned by the function. Default False."/>
        <param label="previous Gibbs sampler" name="zs" type="data" format="txt" optional="true" help="list of assignments computed in a previous run of the Gibbs sampler. Optional, default None."/>
        <param label="Gibbs sampler output" name="zs_out" type="data" format="txt" optional="true" help="file name to save the list of assignments computed in the current run of the Gibbs sampler."/>
    </inputs>

    <outputs>
        <data label="${tool.name} annotations on ${on_string}" name="annotations_out" format="csv"/>
        <data label="${tool.name} zs on ${on_string}" name="zs_out" optional="true">
            <filter>options['all_out']</filter>
        </data>
    </outputs>

    <tests>
        <test>
            <param name="mapped_isotope_patterns" value="mapped_isotope_patterns.csv"/>
            <param name="annotations" value="test_Gibbs_sampler_add_annotations.csv"/>
            <param name="noits" value="1000"/>
            <param name="delta_add" value="0.1"/>
            <output name="annotations_out" file="gibbs_sample_add_annotations.csv" />
        </test>
    </tests>

    <help><![CDATA[
        ::
            Gibbs sampler for the IPA model.
    ]]></help>

    <expand macro="citations"/>
</tool>