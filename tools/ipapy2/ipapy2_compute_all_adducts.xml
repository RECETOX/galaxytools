<tool id="ipapy2_compute_all_adducts" name="IPA compute all adducts" version="@TOOL_VERSION@+galaxy0" profile="21.05">
    <macros>
        <import>macros.xml</import>
    </macros>
    
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">ipapy2</requirement>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        python3 '${ipapy2_compute_all_adducts_cli}'
    ]]></command>

<configfiles>
<configfile name="ipapy2_compute_all_adducts_cli">
@init_import@
import os

adducts_df = pd.read_csv('${adducts_data}')
MS1_DB_df = pd.read_csv('${MS1_DB}')
all_adducts = ipa.compute_all_adducts(adducts_df, MS1_DB_df, ionisation=int(${ionisation}), ncores=int(os.environ.get('GALAXY_SLOTS')))
all_adducts.to_csv('${all_adducts}', index=False)
</configfile>
</configfiles>

    <inputs>
        <param label="Adducts data" name="adducts_data" type="data" format="csv" help="A csv file containing information on all possible adducts."/>
        <param label="MS database" name="MS1_DB" type="data" format="csv" help="A csv file containing the MS1 database."/>
        <expand macro="ionisation"/>
    </inputs>

    <outputs>
        <data label="${tool.name} on ${on_string}" name="all_adducts" format="csv"/>
    </outputs>
    
    <tests>
        <test>
            <param name="adducts_data" value="adducts.csv"/>
            <param name="MS1_DB" value="MS1_DB.csv"/>
            <param name="ionisation" value="1"/>
            <output name="all_adducts" file="all_adducts.csv"/>
        </test>
    </tests>
    
    <help><![CDATA[
    ::
        compute all adducts table based on the information present in the database
    ]]></help>

    <expand macro="citations"/>
</tool>