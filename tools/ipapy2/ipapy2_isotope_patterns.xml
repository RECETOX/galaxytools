<tool id="ipapy2_isotope_patterns" name="IPA isotope patterns" version="@TOOL_VERSION@+galaxy0" profile="21.05">
    <macros>
        <import>macros.xml</import>
    </macros>
    
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">ipapy2</requirement>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        python3 '${ipapy2_isotope_cli}'
    ]]></command>

<configfiles>
<configfile name="ipapy2_isotope_cli">
@init_import@

ipa_dataframe = pd.read_csv('${isotope_input}')
ipa.map_isotope_patterns(ipa_dataframe, isoDiff=$isotope.isoDiff, ppm=$isotope.ppm, ionisation=int(${ionisation}), MinIsoRatio=$isotope.isotope_ratio)
ipa_dataframe.to_csv('${isotope_output}', index=False)
</configfile>
</configfiles>

    <inputs>
        <param label="IPA dataframe" name="isotope_input" type="data" format="csv" help="a dataframe of clustered features." />
        <expand macro="ionisation"/>
        <section name="isotope" title="isotope settings">
            <param name="isoDiff" type="float" value="1">
                <label>isotope difference</label>
                <help>Difference between isotopes of charge 1.</help>
            </param>
            <param name="ppm" type="float" value="100">
                <label>ppm between isotopes</label>
                <help>Maximum ppm value allowed between 2 isotopes. Default value 100.</help>
            </param>
            <param name="isotope_ratio" type="float" min="0" max="100" value="0.5">
                <label>isotope ratio</label>
                <help>mininum intensity ratio expressed (Default value 0.5%). 
				Only isotopes with intensity higher than MinIsoRatio% of the main isotope are considered</help>
            </param>
        </section>
    </inputs>
    
    <outputs>
         <data label="${tool.name} on ${on_string}" name="isotope_output" format="csv"/>
   </outputs>
    
    <tests>
        <test>
            <param name="isotope_input" value="clustered features.csv"/>
            <output name="isotope_output" file="isotope_output.csv"/>
        </test>
    </tests>

    <help><![CDATA[
	::
		mapping isotope patterns in MS1 data.
    ]]></help>

    <expand macro="citations"/>
</tool>