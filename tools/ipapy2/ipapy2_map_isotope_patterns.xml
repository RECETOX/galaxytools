<tool id="ipapy2_map_isotope_patterns" name="IPA map isotope patterns" version="@TOOL_VERSION@+galaxy0" profile="21.05">
    <macros>
        <import>macros.xml</import>
    </macros>
    
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">ipapy2</requirement>
        <expand macro="extra_requirements"/>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        python3 '${__tool_directory__}/ipapy2_map_isotope_patterns.py'
        --input_dataset '${clustered_MS1_intensities}' '${clustered_MS1_intensities.ext}'
        --isoDiff ${isoDiff}
        --ppm ${ppm}
        --ionisation ${ionisation}
        --isotope_ratio ${isotope_ratio}
        --output_dataset '${mapped_isotope_patterns}' '${mapped_isotope_patterns.ext}'
    ]]></command>

    <inputs>
        <param label="IPA dataframe" name="clustered_MS1_intensities" type="data" format="csv,tsv,tabular,parquet" help="A csv file of clustered MS1 intensities." />
        <expand macro="ionisation"/>
        <section name="isotope" title="isotope settings">
            <param name="isoDiff" type="float" value="1">
                <label>isotope difference</label>
                <help>Difference between isotopes of charge 1.</help>
            </param>
            <expand macro="ppm"/>
            <param name="isotope_ratio" type="float" min="0" max="100" value="1">
                <label>isotope ratio</label>
                <help>mininum intensity ratio expressed (Default value 1%). 
				Only isotopes with intensity higher than MinIsoRatio% of the main isotope are considered</help>
            </param>
        </section>
    </inputs>
    
    <outputs>
         <data label="${tool.name} on ${on_string}" name="mapped_isotope_patterns" format_source="clustered_MS1_intensities"/>
   </outputs>
    
    <tests>
        <test>
            <param name="clustered_MS1_intensities" value="clustered_MS1_intensities.csv"/>
            <output name="mapped_isotope_patterns">
                <assert_contents>
                    <has_n_columns n="8"  sep=","/>
                    <has_n_lines n="50" delta="5" />
                    <has_line line="ids,rel.ids,mzs,RTs,Int,relationship,isotope pattern,charge" />
                </assert_contents>
            </output>
        </test>
    </tests>

    <help><![CDATA[
	::
		mapping isotope patterns in MS1 data.
    ]]></help>

    <expand macro="citations"/>
</tool>