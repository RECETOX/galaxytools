<tool id="ipapy2_all_adducts" name="IPA compute all adducts" version="@TOOL_VERSION@+galaxy0" profile="21.05">
    <macros>
        <import>macros.xml</import>
    </macros>
    
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">ipapy2</requirement>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        python3 '${ipapy2_all_adducts_cli}'
    ]]></command>

<configfiles>
<configfile name="ipapy2_all_adducts_cli">
@init_import@
import os

adducts_table = pd.read_csv('${adducts_table}')
DB_table = pd.read_csv('${DB_table}')
all_adducts = ipa.compute_all_adducts(adducts_table, DB_table, ionisation=int(${ionisation}), ncores=int(os.environ.get('GALAXY_SLOTS')))
all_adducts.to_csv('${output}', index=False)
</configfile>
</configfiles>

    <inputs>
        <param label="Adducts table" name="adducts_table" type="data" format="csv" help="Dataframe containing information on all possible adducts."/>
        <param label="DB table" name="DB_table" type="data" format="csv" help="Dataframe containing a database."/>
        <expand macro="ionisation"/>
    </inputs>

    <outputs>
        <data label="${tool.name} on ${on_string}" name="output" format="csv"/>
    </outputs>
    
    <tests>
        <test>
            <param name="adducts_table" value="adducts.csv"/>
            <param name="DB_table" value="DB.csv"/>
            <param name="ionisation" value="1"/>
            <output name="output" file="all_adducts.csv"/>
        </test>
    </tests>
    
    <help><![CDATA[
    ::
        compute all adducts table based on the information present in the database
    ]]></help>

    <expand macro="citations"/>
</tool>